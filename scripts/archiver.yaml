apiVersion: v1
kind: Pod
metadata:
  name: archiver
  namespace: wad
spec:
  containers:
    - name: archiver
      image: thavlik/dorch-archiver:latest
      imagePullPolicy: Always
      command: ["python", "-u", "/app/download_wad.py"]
      env:
        - name: PYTHONUNBUFFERED
          value: "1"
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: spaces-cred
              key: access_key_id
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: spaces-cred
              key: secret_access_key
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 1000m
          memory: 512Mi
      volumeMounts:
        - name: data
          mountPath: /data
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: data
